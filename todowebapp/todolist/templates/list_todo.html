{% extends "master.html" %}
{% block content %}
    <table class="table my-4">
      <thead>
        <tr>
          {% for field in fields %}
          <th scope="col">{{ field }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for task in tasks %}
        <tr>
          <td class="text-center" style="color: dodgerblue">
            {% if task.status == 0 %}
            <i class="bi bi-square"></i>
            {% elif task.status == 1 %}
            <i class="bi bi-square-half"></i>
            {% elif task.status == 2 %}
            <i class="bi bi-square-fill"></i>
            {% endif %}
          </td>
          
          <td>{{ task.title }}</td>
          
          <td class="text-center">
            {% if task.priority == 0 %}
              <span class="badge text-bg-green" style="background-color: green;">{{ task.get_priority_display }}</span>
            {% elif task.priority == 1 %}
              <span class="badge text-bg-orange" style="background-color: orange; color: white;">{{ task.get_priority_display }}</span>
            {% elif task.priority == 2 %}
              <span class="badge text-bg-red" style="background-color: red;">{{ task.get_priority_display }}</span>
            {% elif task.priority == 3 %}
              <span class="badge text-bg-purple" style="background-color: purple;">{{ task.get_priority_display }}</span>
            {% else %}
              {{ task.get_priority_display }}
            {% endif %}
          </td>

          <td>{{ task.due_date|default:"—" }}</td>
          <td>{{ task.comment|default:"—" }}</td>
          <td>{{ task.delivered_to|default:"—" }}</td>
          <td>{{ task.created_at }}</td>
          <td>{{ task.updated_at }}</td>
        </tr>
        {% endfor %}
        
        <tr class="table">
          <td colspan="{{ fields|length }}" class="text-center">
            <a class="btn" data-bs-toggle="collapse" href="#newTaskForm" role="button" aria-expanded="false" aria-controls="newTaskForm">
              <i class="bi bi-plus-circle"></i> Add new task
            </a>
          </td>
        </tr>
        
      </tbody>
    </table>

    <div class="collapse mt-3" id="newTaskForm">
      <form method="post" class="border rounded p-3 bg-light" style="max-width: 500px; margin: 0 auto; font-size: 0.9rem;">
        {% csrf_token %}
        {{ form.as_p }}
        <div class="mt-2 d-flex justify-content-center gap-2">
          <button type="submit" class="btn btn-success btn-sm">
            <i class="bi bi-check-circle"></i> Save
          </button>
          <a href="{% url 'get_all_tasks' %}" class="btn btn-secondary btn-sm">
            <i class="bi bi-x-circle"></i> Cancel
          </a>
        </div>
      </form>
    </div>

{% endblock %}
{% block css %}
    {{ block.super}} {# richiama il blocco del padre #}
{% endblock %}
{% block javascript %}
    {{ block.super}} {# richiama il blocco del padre #}
{% endblock %}